# 📌 Sense Check Notes – Merkle Inclusion Proof 자동화

## 1️⃣ 왜 홀수 리프 복제가 필요한가?

- 이진 트리는 부모가 항상 두 자식을 가져야 해.
- 짝이 없으면 자기 자신을 복제해 해시 → 트리 완전성 유지.

## 2️⃣ XOR 1로 형제 인덱스를 구하는 이유?

- 0↔1, 2↔3,… 패턴을 한 줄 연산으로 처리 (짝수/홀수 자리 스위칭).

## 3️⃣ Proof 실패 원인 Top 3

| 원인                | 설명                                           |
| ------------------- | ---------------------------------------------- |
| 공백/개행 미제거    | `"elderberry"` vs `"elderberry\n"` 해시 불일치 |
| 방향(dir) 잘못 지정 | left/right 반대로 결합 → 해시 달라짐           |
| 홀수 리프 복제 누락 | 형제 해시 없이 루트 계산 → 검증 실패           |

## 4️⃣ 인코딩 주의

- 파일 저장·로그 작성 시 `encoding="utf-8"` 권장 (이모지·다국어 안전).

## 5️⃣ 핵심 교훈

- Merkle Tree는 **입력 순서와 내용이 1비트만 달라도 루트가 완전히 달라짐**.
- Proof 생성 로직이 트리 생성 규칙을 100 % 동일하게 따라야 검증 성공.
