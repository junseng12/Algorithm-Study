# 📌 Sense Check Notes – Merkle 상태 업데이트 검증 시스템

## 1️⃣ 왜 업데이트마다 Merkle Root를 다시 계산해야 하나?

- Merkle Tree는 **불변 구조**이기 때문에, 단 하나의 값만 바뀌어도 트리 전반이 변경됨.
- Root는 트리 전체의 **무결성 요약값**이기 때문에, 업데이트가 있다면 새 루트를 반드시 계산해야 함.

## 2️⃣ Inclusion Proof는 무엇을 검증하나?

- 특정 데이터 항목이 **기존 Merkle Tree에 포함되어 있었는지**를 입증하는 과정.
- 업데이트 이전의 트리와 비교해 ‘데이터 위변조 또는 삽입 여부’를 판단 가능.

## 3️⃣ 자주 틀리는 실수 Top 3

| 원인                                | 설명                                                                   |
| ----------------------------------- | ---------------------------------------------------------------------- |
| 해시 대상 문자열 미정제             | `"grape"` vs `"grape\n"` 처럼 개행 문자 포함 → 해시 불일치             |
| `update_instructions.txt` 파싱 실수 | `"2 apple"`처럼 띄어쓰기 기준 split을 명확히 해야 함                   |
| 변경된 `data`를 트리에 반영 안함    | 리스트를 업데이트하지 않거나, 기존 leaf로 트리 다시 생성함 → 검증 실패 |

## 4️⃣ 디버깅 포인트: 왜 old_root와 비교하나?

- **루트 변경 감지** = 데이터가 정말로 바뀌었는지 확인.
- 같은 index에 같은 값이 들어오면 루트는 유지 → 실제 변경이 없음을 의미.

## 5️⃣ 인코딩 & 출력 주의사항

- 로그 기록에는 항상 `encoding="utf-8"` 사용.
- `✔️`, `❌`, `✅` 등의 이모지는 CP949 환경에서는 `UnicodeEncodeError` 발생 가능.

## 6️⃣ 핵심 교훈

- Merkle Tree 기반 검증 시스템에서 **루트와 증명 로직의 정확성은 생명선**이다.
- 트리 생성 → 증명 → 검증 흐름이 완벽하게 일치해야 신뢰할 수 있는 시스템이 된다.
